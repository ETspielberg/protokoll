<div style="padding: 10px;" class="jumbotron">
  <div class="container">
    <h1 style="padding: 20px;" *ngIf="primaryLoad">
      Ausleihprotokoll
    </h1>
    <p style="padding: 10px;" *ngIf="primaryLoad">Alle Details zu einem Titel</p>
    <div class="ui-g ui-fluid">
      <form (submit)="getFullManifestations()" (keyup.enter)="getFullManifestations()">
      <div class="ui-g-12 ui-md-3">
        <span class="ui-float-label">
        <input id="float-input" type="text" size="30" pInputText [(ngModel)]="protokollRequest.shelfmark" [ngModelOptions]="{standalone: true}" autofocus
               pTooltip="Bitte Signatur eingeben" tooltipPosition="bottom">
        <label for="float-input">Signatur</label>
        </span>
      </div>
      <div class="ui-g-12 ui-md-3">
        <span class="ui-float-label">
        <input [(ngModel)]="protokollRequest.collections" id="collections-primary" pInputText name="collections"
               size="20" pTooltip="z.B. E31, E3, D45, E (mehrere durch Leerzeichen trennen)" tooltipPosition="bottom" [ngModelOptions]="{standalone: true}"/>
        <label for="collections-primary">Standorte</label>
        </span>
      </div>
      <div class="ui-g-12 ui-md-3">
        <p-toggleButton onLabel="Nur diese Auflage" offLabel="Alle Auflagen"
                        [(ngModel)]="protokollRequest.exact" [ngModelOptions]="{standalone: true}"></p-toggleButton>
      </div>
      <div class="ui-g-12 ui-md-3">
        <button pButton type="button" class="ui-button-success" (click)="getFullManifestations()" icon="fa-search"
                label="Abfrage starten"></button>
      </div>
      </form>
    </div>
    <div *ngIf="manifestationsFound" class="ui-g ui-fluid">
      <div class="ui-g-12 ui-md-8">
        <table>
          <tr>
            <th><label>Standorte:</label></th>
            <th style="padding: 5px;" *ngFor="let m of uniqueCollections">
              <p-toggleButton [(ngModel)]="filterList[m]" (onChange)="update()" onLabel="{{m}}"
                              offLabel="{{m}}"></p-toggleButton>
            </th>
          </tr>
        </table>
      </div>
      <div class="ui-g-12 ui-md-4">
        <table>
          <tr>
            <th><label>Materialien:</label></th>
            <th style="padding: 5px;" *ngFor="let m of uniqueMaterials">
              <p-toggleButton [(ngModel)]="filterList[m]" (onChange)="update()" onLabel="{{m}}"
                              offLabel="{{m}}"></p-toggleButton>
            </th>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<p-dialog header="Daten werden abgerufen" [modal]="true" [closable]="false" [(visible)]="busy">
  <img src="../assets/img/loading_newtons_cradle.gif" alt="Loading..." style="width:304px;height:228px;">
</p-dialog>

<p-messages [(value)]="messages"></p-messages>
<div *ngIf="!primaryLoad" class="container-fluid">
  <div class="col-md-12" style="padding: 15px;">
    <div class="alert alert-warning" style="text-align: center;" *ngIf="!manifestationsFound">
      Leider konnten keine Auflagen gefunden werden. Bitte eine gültige Signatur eingeben.
    </div>
  </div>

  <div class="col-sm-2 col-md-2 sidebar" *ngIf="manifestationsFound">
    <ul class="nav nav-sidebar">
      <li *ngFor="let m of manifestations">
        <div class="well well-sm" (click)="toggleSelection(m)" [class.well-active]="filterList[m.titleID]">
          <p>{{m.edition}}. Auflage: {{m.shelfmark}}</p>
          {{m.bibliographicInformation.authors}}:
          {{m.bibliographicInformation.title}}, <b>{{m.bibliographicInformation.year}}</b>.
        </div>
      </li>
    </ul>
  </div>

  <div class="col-md-10" *ngIf="selectedManifestations.length > 0">
    <div class="col-md-12">
      <chart [options]="options" *ngIf="manifestationsFound" style="display: block"></chart>
      <div class="col-md-8 col-md-offset-4">
        <p-inputSwitch id="usergroups" onLabel="Überblick zeigen" offLabel="Nutzgruppen zeigen" (onChange)="update()"
                       [(ngModel)]="showUsergroups"></p-inputSwitch>
      </div>
    </div>

    <div class="col-md-12" *ngIf="selectedItems.length > 0">
      <h3>
        Exemplarübersicht
      </h3>
      <button class="ui-button-success" type="button" pButton (click)="exportTable(dt)" label="Export" icon="fa-table"></button>
      <p-dataTable #dt [value]="selectedItems" [rows]="10" [paginator]="true" [rowsPerPageOptions]="[10,20,50]">
        <p-column field="collection" header="Standort" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="shelfmark" header="Signatur" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="material" header="Medium" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="events.length" header="Ausleihen" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="itemStatus" header="Status" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
      </p-dataTable>
    </div>

    <div class="col-md-12" *ngIf="selectedEvents.length > 0">
      <h3>
        Ereignisprotokoll
      </h3>
      <button class="ui-button-success" type="button" pButton (click)="exportTable(di)" label="Export" icon="fa-table"></button>
      <p-dataTable #di [value]="selectedEvents" [rows]="10" [paginator]="true" [rowsPerPageOptions]="[10,20,50]" sortField="date" [sortOrder]="-1">
        <p-column field="date" header="Datum von" [filter]="true" filterPlaceholder="Filter"></p-column>
        <p-column field="endEvent.date" header="Datum bis" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="duration" header="Tage" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="type" header="Ereignis" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
        <p-column field="borrowerStatus" header="Benutzer" [sortable]="true" [filter]="true"
                  filterPlaceholder="Filter"></p-column>
      </p-dataTable>
    </div>
  </div>
</div>
